# Architecture Decision Record 001

2026-01-26

---

# 1. 배경

기존 `inventory-service`의 `infrastructure.security` 계층이 하던 것
- `identity-service`의 `introspection API` 호출
- `Spring Security` 인증 로직,
- `WebClient` 기반 통신 로직

이 구조는 다음과 같은 문제가 있다.
- 여러 서비스에서 동일한 `introspection API` 로직이 반복됨
- `introspection API` 변경 시 각 서비스의 인프라 계층을 다 수정해야함
- 각 서비스의 인증 로직이 `Spring Security` 필터에 섞여있어서 책임이 불분명함

이에 따라서, `identity-service` 와 통합을 모듈로 분리하고,
`Spring Security` 인증 구조를 `Provider` 중심으로 리팩토링할 필요가 있었다.

# 2. 결정

## 2.1 Identity Client 모듈 분리
- `identity-client` 모듈 분리
- 기존 `inventory-service`의 `introspection API` 구현을 해당 모듈로 이동함
- `identity-service` 와 통신, 응답 모델, 설정 등을 하나의 모듈에 캡슐화함

## 2.2 인증 로직 핵심을 분리
- 인증의 핵심 로직을 `AuthenticationProvider`로 이동함
- Filter는 `Authorization` 헤더에서 `Bearer` 토큰 추출하고 `BearerTokenAuthentication`을 만드는 역할만 함
- 토큰 검증, 활성 여부 판단 등은 Provider가 담당함

## 2.3 AutoConfiguration 도입
- `IdentityClientAutoConfiguration`을 통해서
  - `Introspector`
  - `WebClient` 기반 구현체
  - `@ConditionalOnProperty(prefix = "spring.introspection", name = "enalbed")`를 통해서 identity 인프라 비활성화 가능
  - 서비스는 `application.yml`을 통해서 활성화 여부를 제어  